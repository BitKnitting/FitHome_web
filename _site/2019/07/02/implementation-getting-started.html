<!DOCTYPE html>

<html>

<!-- head.html -->

<head>


  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.6.0 -->
<title>FitHome | Trim the Fat from your Electricity Bills.Help Combat Climate Change.</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="FitHome" />
<meta name="author" content="HappyDay" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Implementation - Monitor Installation" />
<meta property="og:description" content="Implementation - Monitor Installation" />
<link rel="canonical" href="http://localhost:4000/2019/07/02/implementation-getting-started.html" />
<meta property="og:url" content="http://localhost:4000/2019/07/02/implementation-getting-started.html" />
<meta property="og:site_name" content="FitHome" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-07-02T00:00:00-07:00" />
<script type="application/ld+json">
{"headline":"FitHome","dateModified":"2019-07-02T00:00:00-07:00","datePublished":"2019-07-02T00:00:00-07:00","url":"http://localhost:4000/2019/07/02/implementation-getting-started.html","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2019/07/02/implementation-getting-started.html"},"author":{"@type":"Person","name":"HappyDay"},"description":"Implementation - Monitor Installation","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>
     - FitHome
    
  </title>

  <meta name="description"
    content="This post follows on the Getting Started Design post.">
  <!-- favicon -->
  <!-- generated favicon on this site: https://realfavicongenerator.net/ -->
  <!-- Stackoverflow had a Q/A about favicons in jekyll: http://bit.ly/2WcaKx2 -->
  <link rel="shortcut icon" type="image/x-icon"
    href='/img/icon/favicon.ico'>
  <!-- Fonts -->
  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet'
    type='text/css'>
  <link
    href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800'
    rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Roboto:regular,500,700,900' rel='stylesheet' type='text/css'>
  <!-- Font Awesome -->
  <link rel="stylesheet"
    href='/assets/vendor/fontawesome-free/css/all.min.css'>
  <!-- Local Stuff -->
  <link rel="stylesheet" href='/assets/main.css'>
  <link rel="canonical" href="http://localhost:4000/2019/07/02/implementation-getting-started.html">
  <link rel="alternate" type="application/rss+xml" title="FitHome"
    href="/feed.xml">

  <!-- bootstrap css -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <!-- CAREFUL: ORDER IS IMPORTANT.  JQUERY, POPPER, and then BOOTSTRAP -->
  <!-- jquery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
  <!-- popper -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
    crossorigin="anonymous"></script>
  <!-- bootstrap js -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>
</head>

<body>
  <!-- masthead.html -->
<header class="masthead"
    style="background-image: url('/img/bg-post.jpg')">
    <div class="overlay"></div>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-md-10 mx-auto">
                <div class="page-heading">
                    <h1 class="text-light"></h1>
                    
                    <span class="subheading">Implementation - Monitor Installation</span>
                    
                    
                    <!-- The only page that has this is the home/index page. -->
                    

                </div>
            </div>
        </div>
    </div>
</header>

  <!-- navbar.html -->
<nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="/">FitHome</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
      data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
      aria-label="Toggle navigation">
      Menu
      <i class="fa fa-bars"></i>
    </button>

    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href='/'>Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href='/about'>About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href='/tech'>Tech</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href='/posts'>Posts</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href='/contact'>Contact</a>
        </li>
      </ul>
    </div>
  </div>
</nav>



  <!-- post.html -->

<div class="container">
  <div class="row">
    <div class="col-lg-8 col-md-10 mx-auto">

      <link rel="stylesheet" href="/assets/post-entry-style.css" />

<p>This post follows on the <a href="/2019/06/30/design-getting-started.html">Getting Started Design</a> post.</p>

<h1 id="first-interaction">First Interaction</h1>
<p>The first interaction is with the Firebase RT db.  As noted in the design post, one of the steps we take to initiate the FitHome experience is to make a pre-member entry into the Firebase RT db.
<img src="/assets/post-imgs/post-2019-6-30/pre-members-db.png" alt="pre-member db entry" /></p>

<p>We make this entry prior to the electrician installing the energy monitor.</p>
<h1 id="configuring-the-monitor">Configuring the Monitor</h1>
<p>The monitor needs two pieces of information:</p>
<ul>
  <li>The machine name.  This is configured “hard coded” into the firmware.  The machine name is a combination of a common name followed by a ‘-‘ and then the date.  For example, the machine name in the above image is <code class="highlighter-rouge">bambi-07012019</code>. The common name is bambi and the date is 7/1/2019.</li>
  <li>The SSID/password of the homeowner’s wifi.
Ideally, the SSID/password would magically vaporize into the energy monitor when the electrician plugs it in.  Unfortunately, it does not.
    <h2 id="configuring-wifi">Configuring wifi</h2>
    <p>Soon after the electrician installs the energy monitor, the home owner must tell the energy monitor the home wifi SSID and password.  The technique to do this is starting the energy monitor’s firmware as a Local Access Point.  The homeowner goes to their mac or pc and scrolls the available wifi networks.  Once the energy monitor is plugged in, the network <strong>fithome</strong> will be added. 
The home owner:</p>
  </li>
  <li>goes to their mac or pc.</li>
  <li>opens the drop down list of wifi networks and chooses “fithome”.</li>
  <li>uses “fithome” for the password.</li>
  <li>opens a browser and types in the address <code class="highlighter-rouge">192.168.4.1</code></li>
  <li>A web page is shown where the user picks their wifi SSID and enters the password.</li>
</ul>

<p>After successful completion, the energy monitor is able to use the home’s wifi.</p>
<h1 id="sending-readings">Sending Readings</h1>
<p>Now that the energy monitor is online, it will start sending power readings to the Firebase RT db over wifi.  The energy monitor uses the Firebase REST APIs to send readings to the Firebase RT db.  An example curl command:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -X POST -d '{"P":1127.9}' \
  'https://&lt;Firebase project name&gt;.firebaseio.com/&lt;machine name&gt;/.json' 
</code></pre></div></div>
<h2 id="curl-to-http-post">Curl to HTTP Post</h2>
<p>The firmware uses HTTP.  I found this great web page that <a href="https://curl.trillworks.com/">converts curl commands to Python  </a>.  VERY HELPFUL.</p>
<h2 id="example-post">Example post</h2>
<p>For example, this code would send the power value to the Firebaase RT db that is attached to the iot-test-1e426 project:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    def send_reading(self, v1, v2, i1, i2, power):
        do_connect(self.ssid, self.password)
        # .sv timestamp: http://bit.ly/2MO0XNt
        #data = '{'+'"P":{},".sv":"timestamp"'.format(power) +'}'
        data = '{'+'"P":{}'.format(power) +',"timestamp": {".sv":"timestamp"}}'
        path = 'https://iot-test-1e426.firebaseio.com/'+self.device_name+'/'+self.userID+'/.json'
        print(path)
        response = requests.post(path, data=data)
        print('response: {}'.format(response.text))
</code></pre></div></div>
<p>The power reading is sent.  The “timestamp” is generated on the Firebase server then filled into the db entry.</p>


      <hr>

      <div class="clearfix">

        
        <a class="btn btn-primary float-left"
          href="/2019/06/30/design-getting-started.html" data-toggle="tooltip"
          data-placement="top" title="">&larr; Previous<span class="d-none d-md-inline">
            Post</span></a>
        
        
        <a class="btn btn-primary float-right" href="/2019/07/03/hw-and-fiw-Energy-Monitor.html"
          data-toggle="tooltip" data-placement="top" title="">Next<span class="d-none d-md-inline">
            Post</span> &rarr;</a>
        

      </div>

    </div>
  </div>
</div>

  <!-- footer.html -->

<hr>

<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        <ul class="list-inline text-center">
          
          
          
          
        </ul>
        <p class="copyright text-muted">Copyright &copy; HappyDay 2019</p>
      </div>
    </div>
  </div>
</footer>

  <!-- <script src="/assets/vendor/jquery/jquery.min.js"></script>
<script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/assets/vendor/startbootstrap-clean-blog/js/clean-blog.min.js"></script>

<script src="/assets/scripts.js"></script>


 -->
  

</body>

</html>